script EverGrandeCity_E4Battle1_CenterTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_CenterTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle1_PrepDialogue)
}

script EverGrandeCity_E4Battle1_RightTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_RightTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle1_PrepDialogue)
}

script EverGrandeCity_E4Battle1_LeftTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_LeftTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle1_PrepDialogue)
}

script EverGrandeCity_E4Battle1_PrepDialogue {
	playse(SE_TRUCK_DOOR)
	setmetatile(5, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(6, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(7, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(5, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	setmetatile(6, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	setmetatile(7, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	special(DrawWholeMapView)
	msgbox(format("CAROLINE: Think you're ready for this, bitch?\pBRANDON: Caroline, calm down. No need to be so worked up.\pCAROLINE: Whatever, I'm ready to go! No need for a warm up!"))
	multichoicedefault(20, 8, MULTI_EASYHARD, 1, FALSE)
	switch(var(VAR_RESULT)) {
		case 1:
			trainerbattle_double(TRAINER_ZANDER, Route116_LeaderBattleIntro, E4Battle1_BossDefeated, AbandonedShip_Rooms2_1F_Text_KiraNotEnoughMons, E4Battle1_EndBossFight, NO_MUSIC)
		case 0:
			trainerbattle_double(TRAINER_LEAH, Route116_LeaderBattleIntro, E4Battle1_BossDefeated, AbandonedShip_Rooms2_1F_Text_KiraNotEnoughMons, E4Battle1_EndBossFight, NO_MUSIC)
	}
	closemessage
}

text E4Battle1_BossDefeated {
	format("CAROLINE: Wha- argh, I thought we were in tune!\pBRANDON: ...Congratulations. That was well done.")
}

script E4Battle1_EndBossFight {
	msgbox(format("CAROLINE: Good job, I guess.\pBRANDON: I hope you're ready for what comes next."))
	call(PokemonLeague_EliteFour_SetAdvanceToNextRoomMetatiles)
	closemessage
}

script EverGrandeCity_E4Battle2_CenterTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_CenterTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle2_PrepDialogue)
}

script EverGrandeCity_E4Battle2_RightTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_RightTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle2_PrepDialogue)
}

script EverGrandeCity_E4Battle2_LeftTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_LeftTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle2_PrepDialogue)
}

script EverGrandeCity_E4Battle2_PrepDialogue {
	playse(SE_TRUCK_DOOR)
	setmetatile(5, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(6, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(7, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(5, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	setmetatile(6, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	setmetatile(7, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	special(DrawWholeMapView)
	msgbox(format("NOAH: Lookie here! I spy, with my little eye...\pNICK: Hmmm.... are you afraid?"))
	multichoicedefault(20, 8, MULTI_EASYHARD, 1, FALSE)
	switch(var(VAR_RESULT)) {
		case 1:
			trainerbattle_double(TRAINER_SHELLY_WEATHER_INSTITUTE, Route116_LeaderBattleIntro, E4Battle2_BossDefeated, AbandonedShip_Rooms2_1F_Text_KiraNotEnoughMons, E4Battle2_EndBossFight, NO_MUSIC)
		case 0:
			trainerbattle_double(TRAINER_DAISY, Route116_LeaderBattleIntro, E4Battle2_BossDefeated, AbandonedShip_Rooms2_1F_Text_KiraNotEnoughMons, E4Battle2_EndBossFight, NO_MUSIC)
	}
	closemessage
}

text E4Battle2_BossDefeated {
	format("NICK: Fuck! Shit! Fuck!\pNOAH: GRAAAAAAH!")
}

script E4Battle2_EndBossFight {
	msgbox(format("NOAH: ...\pNICK: ...\pNOAH:...\pNICK: You can keep going. Did we not mention that?"))
	call(PokemonLeague_EliteFour_SetAdvanceToNextRoomMetatiles)
	closemessage
}

script EverGrandeCity_E4Battle3_CenterTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_CenterTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle3_PrepDialogue)
}

script EverGrandeCity_E4Battle3_RightTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_RightTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle3_PrepDialogue)
}

script EverGrandeCity_E4Battle3_LeftTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_LeftTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle3_PrepDialogue)
}

script EverGrandeCity_E4Battle3_PrepDialogue {
	playse(SE_TRUCK_DOOR)
	setmetatile(5, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(6, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(7, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(5, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	setmetatile(6, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	setmetatile(7, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	special(DrawWholeMapView)
	msgbox(format("AVAANI: Why, hello!\pMATTHEW: Hi.\pAVAANI: Ooooooh, I can't wait! I'm so excited!\pMATTHEW: Me too. Ready?"))
	multichoicedefault(20, 8, MULTI_EASYHARD, 1, FALSE)
	switch(var(VAR_RESULT)) {
		case 1:
			trainerbattle_double(TRAINER_SHELLY_SEAFLOOR_CAVERN, Route116_LeaderBattleIntro, E4Battle3_BossDefeated, AbandonedShip_Rooms2_1F_Text_KiraNotEnoughMons, E4Battle3_EndBossFight, NO_MUSIC)
		case 0:
			trainerbattle_double(TRAINER_ROSE_1, Route116_LeaderBattleIntro, E4Battle3_BossDefeated, AbandonedShip_Rooms2_1F_Text_KiraNotEnoughMons, E4Battle3_EndBossFight, NO_MUSIC)
	}
	closemessage
}

text E4Battle3_BossDefeated {
	format("AVAANI: Yep, that was so cool!\pMATTHEW: Pretty good!")
}

script E4Battle3_EndBossFight {
	msgbox(format("AVAANI: I'll be watching your next battle, I can't miss this.\pMATTHEW: Me neither. Good luck!"))
	call(PokemonLeague_EliteFour_SetAdvanceToNextRoomMetatiles)
	closemessage
}

script EverGrandeCity_E4Battle4_CenterTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_CenterTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle4_PrepDialogue)
}

script EverGrandeCity_E4Battle4_RightTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_RightTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle4_PrepDialogue)
}

script EverGrandeCity_E4Battle4_LeftTrigger {
	applymovement(OBJ_EVENT_ID_PLAYER, E4_LeftTrigger)
	waitmovement(0)
	call(EverGrandeCity_E4Battle4_PrepDialogue)
}

script EverGrandeCity_E4Battle4_PrepDialogue {
	playse(SE_TRUCK_DOOR)
	setmetatile(5, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(6, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(7, 12, METATILE_EliteFour_EntryDoor_ClosedTop, TRUE)
	setmetatile(5, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	setmetatile(6, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	setmetatile(7, 13, METATILE_EliteFour_EntryDoor_ClosedBottom, TRUE)
	special(DrawWholeMapView)
	msgbox(format("BELINDA: Well.\pNATASHA: Hey! Long time no see.\pBELINDA: You haven't seen all my tricks yet. Are you fine with that?"))
	multichoicedefault(20, 8, MULTI_EASYHARD, 1, FALSE)
	switch(var(VAR_RESULT)) {
		case 1:
			trainerbattle_double(TRAINER_ARCHIE, Route116_LeaderBattleIntro, E4Battle4_BossDefeated, AbandonedShip_Rooms2_1F_Text_KiraNotEnoughMons, E4Battle4_EndBossFight, NO_MUSIC)
		case 0:
			trainerbattle_double(TRAINER_FELIX, Route116_LeaderBattleIntro, E4Battle4_BossDefeated, AbandonedShip_Rooms2_1F_Text_KiraNotEnoughMons, E4Battle4_EndBossFight, NO_MUSIC)
	}
	closemessage
}

text E4Battle4_BossDefeated {
	format("NATASHA: That was great!\pBELINDA: I'm so tired...")
}

script E4Battle4_EndBossFight {
	msgbox(format("BELINDA: Yawn...\pNATASHA: Woohoo! Just one fight left!"))
	call(PokemonLeague_EliteFour_SetAdvanceToNextRoomMetatiles)
	closemessage
}

movement E4_CenterTrigger {
	walk_up * 5
}

movement E4_RightTrigger {
	walk_up * 4
	walk_left
	walk_up
}

movement E4_LeftTrigger {
	walk_up * 4
	walk_right
	walk_up
}

raw `
.set LOCALID_NURSE, 1
.set LOCALID_GUARD_1, 3
.set LOCALID_GUARD_2, 4

EverGrandeCity_PokemonLeague_1F_MapScripts::
	map_script MAP_SCRIPT_ON_TRANSITION, EverGrandeCity_PokemonLeague_1F_OnTransition
	map_script MAP_SCRIPT_ON_RESUME, CableClub_OnResume
	.byte 0

EverGrandeCity_PokemonLeague_1F_OnTransition:
	setrespawn HEAL_LOCATION_EVER_GRANDE_CITY_POKEMON_LEAGUE
	setflag FLAG_LANDMARK_POKEMON_LEAGUE
	call_if_unset FLAG_ENTERED_ELITE_FOUR, EverGrandeCity_PokemonLeague_1F_EventScript_GuardsBlockDoor
	end

EverGrandeCity_PokemonLeague_1F_EventScript_GuardsBlockDoor::
	setobjectxyperm LOCALID_GUARD_1, 8, 2
	setobjectxyperm LOCALID_GUARD_2, 11, 2
	return

EverGrandeCity_PokemonLeague_1F_EventScript_Nurse::
	setvar VAR_0x800B, LOCALID_NURSE
	call Common_EventScript_PkmnCenterNurse
	waitmessage
	waitbuttonpress
	release
	end

EverGrandeCity_PokemonLeague_1F_EventScript_Clerk::
	lock
	faceplayer
	message gText_HowMayIServeYou
	waitmessage
	pokemart EverGrandeCity_PokemonLeague_1F_Pokemart
	msgbox gText_PleaseComeAgain, MSGBOX_DEFAULT
	release
	end

	.align 2
EverGrandeCity_PokemonLeague_1F_Pokemart:
	.2byte ITEM_ULTRA_BALL
	.2byte ITEM_HYPER_POTION
	.2byte ITEM_MAX_POTION
	.2byte ITEM_FULL_RESTORE
	.2byte ITEM_FULL_HEAL
	.2byte ITEM_REVIVE
	.2byte ITEM_MAX_REPEL
	.2byte ITEM_NONE
	release
	end

@ The door guards only check for FLAG_BADGE06_GET because Winonas badge is the only one that can be skipped
@ Its assumed the player has the remaining badges
EverGrandeCity_PokemonLeague_1F_EventScript_DoorGuard::
	lockall
	playfanfare MUS_OBTAIN_BADGE
	message EverGrandeCity_PokemonLeague_1F_Text_GoForth
	waitmessage
	waitfanfare
	closemessage
	copyobjectxytoperm LOCALID_GUARD_1
	copyobjectxytoperm LOCALID_GUARD_2
	setflag FLAG_ENTERED_ELITE_FOUR
	releaseall
	end

EverGrandeCity_PokemonLeague_1F_EventScript_PlayerMoveToFrontFromRight::
	applymovement OBJ_EVENT_ID_PLAYER, EverGrandeCity_PokemonLeague_1F_Movement_MoveToFrontFromRight
	waitmovement 0
	return

EverGrandeCity_PokemonLeague_1F_EventScript_PlayerMoveToFrontFromLeft::
	applymovement OBJ_EVENT_ID_PLAYER, EverGrandeCity_PokemonLeague_1F_Movement_MoveToFrontFromLeft
	waitmovement 0
	return

EverGrandeCity_PokemonLeague_1F_EventScript_NotAllBadges::
	playse SE_FAILURE
	msgbox EverGrandeCity_PokemonLeague_1F_Text_HaventObtainedAllBadges, MSGBOX_DEFAULT
	releaseall
	end

EverGrandeCity_PokemonLeague_1F_EventScript_GoForth::
	applymovement VAR_LAST_TALKED, Common_Movement_FacePlayer
	waitmovement 0
	msgbox EverGrandeCity_PokemonLeague_1F_Text_GoForth, MSGBOX_DEFAULT
	closemessage
	applymovement VAR_LAST_TALKED, Common_Movement_FaceOriginalDirection
	waitmovement 0
	releaseall
	end

EverGrandeCity_PokemonLeague_1F_Movement_MoveToFrontFromRight:
	walk_down
	walk_left
	walk_in_place_faster_up
	step_end

EverGrandeCity_PokemonLeague_1F_Movement_MoveToFrontFromLeft:
	walk_down
	walk_right
	walk_in_place_faster_up
	step_end

EverGrandeCity_PokemonLeague_1F_Movement_LeftGuardOutOfWay:
	walk_left
	walk_in_place_faster_down
	step_end

EverGrandeCity_PokemonLeague_1F_Movement_RightGuardOutOfWay:
	walk_right
	walk_in_place_faster_down
	step_end

EverGrandeCity_PokemonLeague_1F_Text_MustHaveAllGymBadges:
	.string "Beyond this point, only those TRAINERS\n"
	.string "who have collected all the GYM BADGES\l"
	.string "are permitted to enter.\p"
	.string "TRAINER, let us confirm that you have\n"
	.string "all the GYM BADGES.$"

EverGrandeCity_PokemonLeague_1F_Text_HaventObtainedAllBadges:
	.string "You haven't obtained all the BADGES.\p"
	.string "If you're bound for the POKéMON\n"
	.string "LEAGUE, you must return with them.$"

EverGrandeCity_PokemonLeague_1F_Text_GoForth:
	.string "TRAINER! Believe in yourself and your\n"
	.string "POKéMON, and go forth!$"

`
